# API Contracts for Notes Manager

This document outlines the API contracts for the Notes Manager application, ensuring seamless integration between the React frontend and FastAPI backend.

## 1. Data Models

### Note Model

Represents a single note entry. Matches the structure expected by the frontend's `mockNotes`.

-   **`Note` (Pydantic Model / MongoDB Document)**
    -   `id`: `str` (Unique identifier, auto-generated by backend, represented as `_id` in MongoDB)
    -   `title`: `str` (Title of the note, required)
    -   `content`: `str` (Main content of the note, required)
    -   `status`: `str` (Current status of the note, e.g., "Active", "Draft", "Pending". Required.)
    -   `created_at`: `datetime` (ISO 8601 string, auto-generated by backend)

### NoteStats Model

Represents aggregated statistics for notes. Matches the structure expected by the frontend's `mockNoteStats`.

-   **`NoteStats` (Pydantic Model)**
    -   `total`: `int` (Total number of notes)
    -   `active`: `int` (Number of notes with 'Active' status)
    -   `draft`: `int` (Number of notes with 'Draft' status)
    -   `pending`: `int` (Number of notes with 'Pending' status)

## 2. REST API Endpoints

All API routes will be prefixed with `/api`.

### 2.1. Notes Endpoints (`/api/notes`)

#### 1. List All Notes

-   **Endpoint**: `GET /api/notes`
-   **Description**: Retrieves a list of all notes, with optional search and pagination.
-   **Query Parameters**:
    -   `search`: `str`, optional (Filter notes by title)
    -   `page`: `int`, optional (Page number for pagination, default: 1)
    -   `limit`: `int`, optional (Number of items per page, default: 10)
-   **Request Body**: None
-   **Success Response**:
    -   `200 OK`
    -   Body:
        ```json
        {
          "data": [
            {
              "id": "string",
              "title": "string",
              "content": "string",
              "status": "string",
              "created_at": "string (ISO 8601)"
            }
          ],
          "total": 100,
          "page": 1,
          "limit": 10
        }
        ```
-   **Error Response**: Standard error format.

#### 2. Create New Note

-   **Endpoint**: `POST /api/notes`
-   **Description**: Creates a new note.
-   **Request Body**:
    ```json
    {
      "title": "string",
      "content": "string",
      "status": "string"
    }
    ```
-   **Success Response**:
    -   `201 Created`
    -   Body:
        ```json
        {
          "data": {
            "id": "string",
            "title": "string",
            "content": "string",
            "status": "string",
            "created_at": "string (ISO 8601)"
          }
        }
        ```
-   **Error Response**: Standard error format.

#### 3. Get Single Note

-   **Endpoint**: `GET /api/notes/{id}`
-   **Description**: Retrieves a single note by its ID.
-   **Path Parameters**:
    -   `id`: `str` (The unique identifier of the note)
-   **Request Body**: None
-   **Success Response**:
    -   `200 OK`
    -   Body:
        ```json
        {
          "data": {
            "id": "string",
            "title": "string",
            "content": "string",
            "status": "string",
            "created_at": "string (ISO 8601)"
          }
        }
        ```
-   **Error Response**: `404 Not Found` if note does not exist, or standard error format.

#### 4. Update Note

-   **Endpoint**: `PUT /api/notes/{id}`
-   **Description**: Updates an existing note by its ID. Supports partial updates.
-   **Path Parameters**:
    -   `id`: `str` (The unique identifier of the note)
-   **Request Body**:
    ```json
    {
      "title": "string (optional)",
      "content": "string (optional)",
      "status": "string (optional)"
    }
    ```
-   **Success Response**:
    -   `200 OK`
    -   Body:
        ```json
        {
          "data": {
            "id": "string",
            "title": "string",
            "content": "string",
            "status": "string",
            "created_at": "string (ISO 8601)"
          }
        }
        ```
-   **Error Response**: `404 Not Found` if note does not exist, or standard error format.

#### 5. Delete Note

-   **Endpoint**: `DELETE /api/notes/{id}`
-   **Description**: Deletes a note by its ID.
-   **Path Parameters**:
    -   `id`: `str` (The unique identifier of the note)
-   **Request Body**: None
-   **Success Response**:
    -   `200 OK`
    -   Body:
        ```json
        {
          "data": {
            "id": "string"
          }
        }
        ```
-   **Error Response**: `404 Not Found` if note does not exist, or standard error format.

### 2.2. Note Statistics Endpoint

#### 1. Get Note Statistics

-   **Endpoint**: `GET /api/notes/stats`
-   **Description**: Retrieves aggregated statistics about notes (total, active, draft, pending).
-   **Request Body**: None
-   **Success Response**:
    -   `200 OK`
    -   Body:
        ```json
        {
          "data": {
            "total": 5,
            "active": 3,
            "draft": 1,
            "pending": 1
          }
        }
        ```
-   **Error Response**: Standard error format.

## 3. Response & Error Format (MUST FOLLOW)

-   **Successful list responses**:
    -   `200 OK`
    -   Body:
        ```json
        {
          "data": [<Entity>],
          "total": number,
          "page": number,
          "limit": number
        }
        ```

-   **Successful single-item responses**:
    -   `200 OK` or `201 Created`
    -   Body:
        ```json
        { "data": <Entity> }
        ```

-   **Error responses**:
    -   `4xx` / `5xx`
    -   Body:
        ```json
        {
          "error": {
            "code": "<MACHINE_READABLE_CODE>",
            "message": "<Human readable message>",
            "details": "optional"
          }
        }
        ```
    This format MUST be consistent across all endpoints. Routers and tests will rely on it.

## 4. Integration Notes

### 4.1. Frontend API Client (`frontend/src/lib/api.js`)

The frontend will utilize a centralized API client (e.g., `frontend/src/lib/api.js`) to interact with these endpoints. This client will abstract away the `fetch` or `axios` calls and handle base URL configuration using `import.meta.env.VITE_API_URL`.

Example structure for `api.js`:

```javascript
// frontend/src/lib/api.js
const API_URL = import.meta.env.VITE_API_URL;

const handleResponse = async (response) => {
  if (!response.ok) {
    const errorData = await response.json();
    throw new Error(errorData.error.message || 'Something went wrong');
  }
  return response.json();
};

export const getNotes = async (search = '', page = 1, limit = 10) => {
  const params = new URLSearchParams();
  if (search) params.append('search', search);
  params.append('page', page);
  params.append('limit', limit);
  const url = `${API_URL}/api/notes?${params.toString()}`;
  const response = await fetch(url);
  return handleResponse(response);
};

export const createNote = async (noteData) => {
  const response = await fetch(`${API_URL}/api/notes`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(noteData),
  });
  return handleResponse(response);
};

export const getNoteById = async (id) => {
  const response = await fetch(`${API_URL}/api/notes/${id}`);
  return handleResponse(response);
};

export const updateNote = async (id, noteData) => {
  const response = await fetch(`${API_URL}/api/notes/${id}`, {
    method: 'PUT',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(noteData),
  });
  return handleResponse(response);
};

export const deleteNote = async (id) => {
  const response = await fetch(`${API_URL}/api/notes/${id}`, {
    method: 'DELETE',
  });
  return handleResponse(response);
};

export const getNoteStats = async () => {
  const response = await fetch(`${API_URL}/api/notes/stats`);
  return handleResponse(response);
};
```

### 4.2. Mock Data Replacement

The `mockNotes` and `mockNoteStats` from `frontend/src/data/mock.js` will be replaced by actual API calls to the defined endpoints. Components like `Home.jsx` and `NotesPage.jsx` will be updated to fetch data from the backend.

### 4.3. Error Handling

The frontend will implement robust error handling, catching exceptions thrown by the API client and displaying user-friendly messages based on the `error.message` field from the backend's error response format.

### 4.4. Pagination

The `GET /api/notes` endpoint supports pagination via `page` and `limit` query parameters. The frontend will consume the `total`, `page`, and `limit` fields from the response to implement pagination controls if needed in the future. Currently, the frontend does not explicitly show pagination, but the backend will provide the necessary data.

### 4.5. Search Functionality

The `GET /api/notes` endpoint supports searching by `title` using the `search` query parameter. The frontend's `NotesPage.jsx` will pass the `searchTerm` to this parameter.
